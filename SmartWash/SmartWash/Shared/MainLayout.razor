@inherits LayoutComponentBase
@using MudBlazor
@using SmartWash.Domain.Entities
@using Microsoft.AspNetCore.Identity

@inject NavigationManager NavigationManager
@inject SignInManager<ApplicationUser> SignInManager

<PageTitle>Smart Wash</PageTitle>

<SmartWashThemeProvider />
<MudDialogProvider />
<MudSnackbarProvider />

<MudLayout>

    <MudAppBar Fixed="false" Elevation="1">
        <MudSpacer/>
            <MudButton Link="/">Home</MudButton>
            <MudButton Link="/about">About</MudButton>
        <AuthorizeView Roles="Member">
            <NotAuthorized>
                <MudButton Link="/Account/Login">Login</MudButton>
                <MudButton Link="/Account/SignUp">Sign Up</MudButton>
            </NotAuthorized>
            <Authorized>
                <MudButton Style="margin-right:20px" OnClick="SignOutUser">Logout</MudButton>
                <MudAvatar Color="Color.Primary">@context.User.Identity?.Name?[0].ToString().ToUpper()</MudAvatar>
            </Authorized>
        </AuthorizeView>
    </MudAppBar>

    <MudMainContent Style="padding: 0;">
        <MudContainer MaxWidth="MaxWidth.False" Style="padding: 0;">
            @Body
        </MudContainer>
    </MudMainContent>
</MudLayout>

@*TODO: Add authorization back when done*@

@code {
    public async Task SignOutUser()
    {
        try
        {
            await SignInManager.SignOutAsync();
        } catch(Exception e)
        {
            // :(
        }

        NavigationManager.NavigateTo("/");
    }
}



